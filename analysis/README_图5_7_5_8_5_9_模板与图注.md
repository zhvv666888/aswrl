# 图 5.7 / 5.8 / 5.9 画图模板 + 图注（可直接粘贴到论文）

> 这些模板是根据你现有的 rosbag2 sqlite 读取方式写的：  
> - `/sync/status` 为 `std_msgs/msg/Float32MultiArray`，同步误差在 `values[2]` 且单位是 **微秒**（脚本里统一换算为 ms 并做线性去趋势），与现有脚本一致。  
>   参考：`plot_stable_compare.py` 中 `values[2]*1e-3` 与去趋势/指标计算流程。  
> - 多峰/抖动等网络状态建议用 `/net_state`（或等价 topic）记录，这一点也在论文图示建议里提到。

## 1) 生成图的脚本

目录内包含 4 个文件：

- `rosbag2_sqlite_utils.py`：通用读取与解析工具（Float32MultiArray/Float32/Int32，去趋势、指标、窗口索引猜测）。
- `figure_5_7_network_delay.py`：图 5.7（网络时延“分布/切换示意”），会输出两张图：
  - `fig_5_7_delay_histograms.png`（三场景直方图）
  - `fig_5_7_delay_timeseries.png`（三场景时延时间序列）
- `figure_5_8_window_trace.py`：图 5.8（窗口长度随时间变化），默认画 **Jitter** 场景，可改 `SCENARIO`。
- `figure_5_9_ci_significance.py`：图 5.9（95%CI + 配对检验 + 效应量汇总），会输出：
  - `fig_5_9_mse_ci_<scenario>.png`
  - `fig_5_9_max_ci_<scenario>.png`
  - `metrics_with_ci_<scenario>.csv`
  - `table_5_x_significance_<scenario>.csv`

### 运行方式（示例）

在你的实验机上（有 `.db3` 的那台）：

```bash
cd generated_fig_templates

python3 figure_5_7_network_delay.py
python3 figure_5_8_window_trace.py
python3 figure_5_9_ci_significance.py
```

> **第一次跑**建议先看脚本打印出来的 topic 列表，确认：  
> - 网络状态 topic（比如 `/net_state`）是否存在；若是 MultiArray，确认 delay 对应的 index。  
> - 窗口长度对应哪个 topic / index（脚本会给出“最像窗口”的 index 排名，帮你快速定位）。

---

## 2) 图注文字（可直接粘贴到论文）

下面给出按你第 5 章结构可直接用的图注（Word/LaTeX 都可）。

### 图 5.7 三类网络场景的时延分布/切换示意

**图注（建议版本）**  
图 5.7 给出了三类网络扰动场景的统计特性，用于解释后续同步误差与窗口决策的差异。稳定场景的链路时延集中在低延迟区间且波动较小；高抖动场景在时间轴上呈现分段式抖动强度变化；多峰突变场景的时延分布表现为多个模式间的随机切换。通过可视化网络状态的“分布形态/切换时刻”，可以将误差长尾与策略在场景切换阶段的响应行为对应起来，为第 5.6 节的综合讨论提供外部条件依据。

> **放置位置建议**：每个场景小节（5.3/5.4/5.5）开头，或 5.2 实验设置后。  
>（该位置建议来自你“新增图片清单”的明确要求。）

---

### 图 5.8 窗口长度随时间变化曲线（FW vs Rule-ASW vs ASW-RL）

**图注（建议版本）**  
图 5.8 展示了三种窗口策略在同一网络场景下的窗口长度随时间变化曲线，并在背景中标注网络统计特性变化区间。可以观察到：固定窗口（FW）保持常值；规则法（Rule-ASW）在扰动统计量波动或模式切换时容易出现频繁切换或窗口异常膨胀；学习策略（ASW-RL）倾向于在保证响应性的同时维持较平滑的窗口调节，从而降低窗口抖动对估计—平滑环节的耦合放大效应。该图将“触发条件—窗口变化—误差突发”建立可视化对应关系，用于解释规则法误差长尾/极值增大的原因。

> **放置位置建议**：第 5.6 节“综合评价与讨论”。  
>（你正文已经承诺对窗口序列做可视化分析，这张图就是兑现承诺的关键。）

---

### 图 5.9 95% 置信区间误差条 + 显著性检验结果摘要

**图注（建议版本）**  
图 5.9 以同步误差序列为样本，给出了关键指标（例如 MSE 与 MAX）的均值及 95% 置信区间，并报告配对统计检验结果（配对 t 检验与 Wilcoxon 符号秩检验）以及效应量（Cohen’s d）。结果表明，在不同网络扰动场景下，学习型策略（ASW-RL）相较固定窗口与规则法在误差均值及极端误差控制方面具有更稳定的优势；规则法在场景切换阶段更易出现长尾，从而导致极值显著增大。通过“CI + 显著性 + 效应量”的组合呈现，可将结论从经验观察提升到统计意义层面的支撑。

> **放置位置建议**：第 5.6 节（你在该节明确写了要画 95%CI、做配对 t/Wilcoxon、算效应量）。

---

## 3) 你现有脚本与这些模板的对应关系

- 你的 `plot_stable_compare.py`、`plot_jitter_compare.py`、`plot_multimodal_compare.py` 都是从 `/sync/status` 读 `values[2]`（微秒→毫秒）并线性去趋势后计算 MSE/STD/MAX，再画箱线图。  
  这些模板直接复用同一解析与去趋势思路，保证口径一致。
- `figure_5_9_ci_significance.py` 额外做了 **moving-block bootstrap**（更适合时间序列）来算 95%CI，并输出 **p 值 + 效应量**的 CSV 表，方便你在 Word 里直接粘“表 5.x”。

如果你跑出来的窗口曲线/网络分布明显不对，通常就是：  
1) 网络状态 topic 名称不一致（不是 `/net_state`）  
2) delay 或 window 的 index 不是脚本默认值（需要改 index）  
3) 单位（s/us/ms）换算没对齐（改 `*_UNIT_SCALE`）

以上 3 个点是最常见的“图对不上论文设定”的原因。
